[
  {
    "fileName": "VirtualizedOptions.tsx",
    "language": "tsx",
    "code": "import { ListRange, Virtuoso } from 'react-virtuoso';\nimport { Combobox, Input, InputBase, ScrollArea, useVirtualizedCombobox } from '@mantine/core';\n\nconst largeData = Array(10000)\n  .fill(0)\n  .map((_, index) => ({\n    value: `value-${index}`,\n    label: `Label ${index}`,\n    id: `item-${index}`,\n    disabled: false,\n  }));\n\nexport function VirtualizedOptions() {\n  const [opened, setOpened] = useState(false);\n  const [selectedOptionIndex, setSelectedOptionIndex] = useState(0);\n  const [activeOptionIndex, setActiveOptionIndex] = useState(-1);\n  const [value, setValue] = useState('');\n  const virtuoso = useRef<any>(null);\n  const viewportRef = useRef<HTMLDivElement>(null);\n  const visibleRangeRef = useRef<ListRange>({\n    startIndex: 0,\n    endIndex: 0,\n  });\n\n  const scrollOptionIntoView = (index: number) => {\n    setTimeout(() => {\n      const isVisible =\n        index >= visibleRangeRef.current.startIndex && index <= visibleRangeRef.current.endIndex;\n      if (index !== -1 && !isVisible) {\n        virtuoso.current.scrollToIndex({ index, align: 'end' });\n      }\n    }, 4);\n  };\n\n  const combobox = useVirtualizedCombobox({\n    opened,\n    onOpenedChange: setOpened,\n    onDropdownOpen: () => {\n      if (activeOptionIndex !== -1) {\n        combobox.selectActiveOption();\n        scrollOptionIntoView(activeOptionIndex);\n      }\n    },\n    isOptionDisabled: (index) => largeData[index].disabled,\n    totalOptionsCount: largeData.length,\n    getOptionId: (index) => largeData[index].id,\n    selectedOptionIndex,\n    activeOptionIndex,\n    setSelectedOptionIndex: (index) => {\n      setSelectedOptionIndex(index);\n      scrollOptionIntoView(index);\n    },\n    onSelectedOptionSubmit: onOptionSubmit,\n  });\n\n  function onOptionSubmit(index: number) {\n    const option = largeData[index];\n    setValue(option.value);\n    setActiveOptionIndex(index);\n    combobox.closeDropdown();\n    combobox.resetSelectedOption();\n  }\n\n  return (\n    <Combobox\n      store={combobox}\n      resetSelectionOnOptionHover={false}\n      keepMounted\n      onOptionSubmit={(option) => {\n        setValue(option);\n        combobox.openDropdown();\n      }}\n    >\n      <Combobox.Target>\n        <InputBase component=\"button\" onClick={() => combobox.toggleDropdown()} pointer>\n          {value || <Input.Placeholder>Pick a value</Input.Placeholder>}\n        </InputBase>\n      </Combobox.Target>\n      <Combobox.Dropdown>\n        <Combobox.Options>\n          <ScrollArea.Autosize\n            mah={220}\n            type=\"scroll\"\n            scrollbarSize={4}\n            viewportRef={viewportRef}\n            onMouseDown={(event) => event.preventDefault()}\n          >\n            <Virtuoso\n              data={largeData}\n              ref={virtuoso}\n              style={{ height: 420 }}\n              customScrollParent={viewportRef.current!}\n              rangeChanged={(range) => {\n                visibleRangeRef.current = range;\n              }}\n              itemContent={(index, item) => (\n                <Combobox.Option\n                  value={item.value}\n                  key={item.value}\n                  selected={index === selectedOptionIndex}\n                  onClick={() => onOptionSubmit(index)}\n                >\n                  {item.label}\n                </Combobox.Option>\n              )}\n            />\n          </ScrollArea.Autosize>\n        </Combobox.Options>\n      </Combobox.Dropdown>\n    </Combobox>\n  );\n}\n"
  }
]